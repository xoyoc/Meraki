<!-- ===== email_verification_sent.html ===== -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Verificación Enviada | Meraki - Capital Humano en Acción{% endblock %}

{% block extra_css %}
<style>
    .verification-gradient {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%);
    }
    
    .verification-card {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.25);
    }
    
    @keyframes mail-fly {
        0% { transform: translateY(0px) rotate(0deg); opacity: 1; }
        50% { transform: translateY(-20px) rotate(5deg); opacity: 0.8; }
        100% { transform: translateY(-40px) rotate(0deg); opacity: 0.6; }
    }
    
    .mail-animation {
        animation: mail-fly 2s ease-in-out infinite alternate;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    
    .floating-element {
        animation: float 6s ease-in-out infinite;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen verification-gradient flex flex-col justify-center py-12 sm:px-6 lg:px-8 relative overflow-hidden">
    <!-- Elementos decorativos -->
    <div class="absolute top-20 left-10 w-20 h-20 bg-white opacity-10 rounded-full floating-element"></div>
    <div class="absolute top-40 right-20 w-16 h-16 bg-white opacity-15 rounded-full floating-element" style="animation-delay: 2s;"></div>
    <div class="absolute bottom-20 left-1/4 w-12 h-12 bg-white opacity-20 rounded-full floating-element" style="animation-delay: 4s;"></div>
    
    <div class="relative sm:mx-auto sm:w-full sm:max-w-md">
        <div class="verification-card rounded-2xl p-8 border border-white border-opacity-20 text-center">
            <!-- Icono animado -->
            <div class="mx-auto w-24 h-24 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mb-6 mail-animation">
                <i class="fas fa-envelope text-white text-3xl"></i>
            </div>
            
            <h2 class="text-2xl font-bold text-gray-900 mb-4">
                ¡Revisa tu correo!
            </h2>
            
            <p class="text-gray-600 mb-6 leading-relaxed">
                Te hemos enviado un enlace de verificación a tu correo electrónico. 
                Haz clic en el enlace para activar tu cuenta y comenzar tu journey en Meraki.
            </p>
            
            <!-- Instrucciones -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-blue-900 mb-3 flex items-center justify-center">
                    <i class="fas fa-info-circle mr-2"></i>
                    Pasos a seguir:
                </h3>
                <ol class="text-left text-sm text-blue-800 space-y-2">
                    <li class="flex items-start">
                        <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                        <span>Abre tu cliente de correo electrónico</span>
                    </li>
                    <li class="flex items-start">
                        <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                        <span>Busca el correo de Meraki (revisa spam si es necesario)</span>
                    </li>
                    <li class="flex items-start">
                        <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                        <span>Haz clic en "Verificar mi cuenta"</span>
                    </li>
                    <li class="flex items-start">
                        <span class="bg-blue-200 text-blue-800 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">4</span>
                        <span>¡Listo! Tu cuenta estará activada</span>
                    </li>
                </ol>
            </div>
            
            <!-- Countdown timer -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-center text-gray-700 mb-2">
                    <i class="fas fa-clock mr-2"></i>
                    <span class="font-medium">El enlace expira en:</span>
                </div>
                <div class="text-2xl font-bold text-meraki-600" id="countdown">23:59:45</div>
            </div>
            
            <!-- Acciones -->
            <div class="space-y-4">
                <button onclick="checkEmail()" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-700 hover:to-blue-600 transition-all duration-200 transform hover:scale-105">
                    <i class="fas fa-external-link-alt mr-2"></i>
                    Abrir Cliente de Correo
                </button>
                
                <button onclick="resendEmail()" class="w-full border border-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-50 transition-colors duration-200" id="resendBtn">
                    <i class="fas fa-redo mr-2"></i>
                    <span id="resendText">Reenviar Correo</span>
                </button>
            </div>
            
            <!-- Ayuda adicional -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <p class="text-sm text-gray-600 mb-3">¿No recibes el correo?</p>
                <div class="space-y-2 text-xs text-gray-500">
                    <p>• Revisa tu carpeta de spam o correo no deseado</p>
                    <p>• Verifica que la dirección de correo sea correcta</p>
                    <p>• El enlace es válido por 24 horas</p>
                </div>
                <div class="mt-4">
                    <a href="{% url 'core:contact' %}" class="text-meraki-600 hover:text-meraki-700 font-medium text-sm">
                        ¿Necesitas ayuda? Contáctanos
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Links adicionales -->
        <div class="mt-8 text-center">
            <p class="text-white text-sm opacity-90">
                ¿Usaste un correo incorrecto? 
                <a href="{% url 'accounts:signup' %}" class="font-medium underline hover:no-underline">
                    Crear nueva cuenta
                </a>
            </p>
        </div>
    </div>
</div>

<script>
// Countdown timer
let timeLeft = 24 * 60 * 60; // 24 horas en segundos

function updateCountdown() {
    const hours = Math.floor(timeLeft / 3600);
    const minutes = Math.floor((timeLeft % 3600) / 60);
    const seconds = timeLeft % 60;
    
    const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    document.getElementById('countdown').textContent = display;
    
    if (timeLeft > 0) {
        timeLeft--;
    } else {
        document.getElementById('countdown').textContent = 'Expirado';
        document.getElementById('countdown').className = 'text-2xl font-bold text-red-600';
    }
}

// Actualizar cada segundo
setInterval(updateCountdown, 1000);

// Función para abrir cliente de correo
function checkEmail() {
    // Detectar el cliente de correo preferido
    const userAgent = navigator.userAgent.toLowerCase();
    let mailClient = 'mailto:';
    
    // Intentar abrir el cliente de correo
    window.location.href = mailClient;
    
    // Mostrar mensaje de éxito después de un pequeño delay
    setTimeout(() => {
        showNotification('Cliente de correo abierto. ¡Revisa tu bandeja de entrada!', 'info');
    }, 1000);
}

// Función para reenviar email
function resendEmail() {
    const resendBtn = document.getElementById('resendBtn');
    const resendText = document.getElementById('resendText');
    
    // Cambiar estado del botón
    resendBtn.disabled = true;
    resendText.textContent = 'Enviando...';
    resendBtn.classList.add('opacity-75');
    
    // Simular reenvío (aquí iría la petición real al servidor)
    setTimeout(() => {
        showNotification('Correo de verificación reenviado exitosamente', 'success');
        
        // Restaurar botón
        resendBtn.disabled = false;
        resendText.textContent = 'Reenviar Correo';
        resendBtn.classList.remove('opacity-75');
        
        // Reiniciar countdown
        timeLeft = 24 * 60 * 60;
        document.getElementById('countdown').className = 'text-2xl font-bold text-meraki-600';
    }, 2000);
}

// Función para mostrar notificaciones
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg text-white shadow-lg transform transition-all duration-300 translate-x-full ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        'bg-blue-500'
    }`;
    notification.innerHTML = `
        <div class="flex items-center">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Animar entrada
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Remover después de 3 segundos
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Auto-refresh cada 30 segundos para verificar si la cuenta fue activada
let checkInterval = setInterval(() => {
    fetch('/accounts/check-verification-status/', {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.verified) {
            clearInterval(checkInterval);
            showNotification('¡Cuenta verificada exitosamente!', 'success');
            setTimeout(() => {
                window.location.href = data.redirect_url || '/accounts/login/';
            }, 2000);
        }
    })
    .catch(error => {
        console.log('Error checking verification status:', error);
    });
}, 30000);
</script>
{% endblock %}